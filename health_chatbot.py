
import streamlit as st

# ▶ 진단 데이터
disease_data = [
    {
        "질병": "감기",
        "증상": ["기침", "콧물", "두통", "목 아픔"],
        "체온조건": "36.5~37.5",
        "약품": ["없음", "생강차"],
        "행동": "따뜻한 물 마시기, 보건실에서 휴식"
    },
    {
        "질병": "독감",
        "증상": ["고열", "기침", "두통", "근육통", "오한"],
        "체온조건": "38 이상",
        "약품": ["타이레놀"],
        "행동": "조퇴, 병원 방문, 휴식, 충분한 수분 섭취"
    },
    {
        "질병": "소화불량",
        "증상": ["복통", "속쓰림", "트림", "배부름"],
        "체온조건": "무관",
        "약품": ["베아제", "훼스탈"],
        "행동": "물 섭취, 식사량 조절, 안정을 취하세요"
    },
    {
        "질병": "스트레스성 두통",
        "증상": ["머리 아픔", "집중력 저하", "피로감"],
        "체온조건": "무관",
        "약품": ["진통제(이부프로펜)"],
        "행동": "조용한 곳에서 휴식, 수면 권장"
    },
    {
        "질병": "생리통",
        "증상": ["아랫배 통증", "피로감", "허리 통증"],
        "체온조건": "무관",
        "약품": ["이브(진통제)"],
        "행동": "따뜻한 물 마시기, 보온, 휴식"
    },
    {
        "질병": "알레르기성 비염",
        "증상": ["콧물", "재채기", "눈 가려움"],
        "체온조건": "무관",
        "약품": ["항히스타민제(지르텍)"],
        "행동": "마스크 착용, 자극원 피하기"
    },
    {
        "질병": "장염",
        "증상": ["설사", "복통", "구토", "메스꺼움"],
        "체온조건": "미열 또는 정상",
        "약품": ["지사제", "수분 보충제"],
        "행동": "수분 섭취, 음식 중단, 병원 방문"
    },
    {
        "질병": "탈수증상",
        "증상": ["어지러움", "입 마름", "피로감"],
        "체온조건": "무관",
        "약품": ["수분 보충용 이온음료"],
        "행동": "물 자주 마시기, 보건실 방문"
    },
    {
        "질병": "근육통",
        "증상": ["통증", "뻣뻣함"],
        "체온조건": "정상",
        "약품": ["파스", "근육이완제"],
        "행동": "스트레칭, 온찜질, 무리한 운동 피하기"
    },
    {
        "질병": "결막염",
        "증상": ["눈 충혈", "눈곱", "가려움"],
        "체온조건": "무관",
        "약품": ["항생제 안약"],
        "행동": "손 씻기, 눈 비비지 않기, 병원 방문"
    },
    {
        "질병": "타박상",
        "증상": ["멍", "붓기", "아픈 부위 눌림"],
        "체온조건": "정상",
        "약품": ["아이스팩", "파스"],
        "행동": "부위를 차갑게 찜질하고 움직임 최소화"
    },
    {
        "질병": "찰과상",
        "증상": ["피부 벗겨짐", "피", "따가움"],
        "체온조건": "정상",
        "약품": ["소독약", "밴드"],
        "행동": "흐르는 물에 세척 후 소독, 밴드 부착"
    },
    {
        "질병": "염좌",
        "증상": ["관절 통증", "붓기"],
        "체온조건": "정상",
        "약품": ["냉찜질", "파스"],
        "행동": "해당 부위 고정 후 찜질, 보건실 방문"
    },
    {
        "질병": "절상",
        "증상": ["출혈", "통증", "상처"],
        "체온조건": "정상",
        "약품": ["소독약", "거즈", "붕대"],
        "행동": "상처 압박 지혈 후 소독, 보건실 방문"
    },
    {
        "질병": "넘어짐/미끄러짐",
        "증상": ["무릎 찰과상", "타박상", "통증"],
        "체온조건": "정상",
        "약품": ["소독약", "밴드", "파스"],
        "행동": "손상 부위 확인 후 필요시 보건실 방문"
    },
    {
        "질병": "이물질 눈에 들어감",
        "증상": ["눈 통증", "이물감", "눈물 흘림"],
        "체온조건": "정상",
        "약품": ["인공눈물"],
        "행동": "문지르지 말고 흐르는 물로 세척, 보건실 즉시 방문"
    }
]

# ▶ 진단 로직
def match_temp_condition(조건, 체온):
    if "이상" in 조건:
        기준 = float(''.join(filter(str.isdigit, 조건)))
        return 체온 >= 기준
    elif "~" in 조건:
        low, high = map(float, 조건.replace("℃", "").split("~"))
        return low <= 체온 <= high
    elif "정상" in 조건:
        return 36.0 <= 체온 <= 37.5
    elif "미열" in 조건:
        return 37.0 <= 체온 < 38.0
    elif "무관" in 조건 or "관계 없음" in 조건:
        return True
    return True

def diagnose(체온, 증상입력):
    for 항목 in disease_data:
        if match_temp_condition(항목["체온조건"], 체온):
            if any(증상 in 증상입력 for 증상 in 항목["증상"]):
                return 항목
    return {"질병": "알 수 없음", "약품": [], "행동": "보건실에 방문하여 상담을 받으세요."}

# ▶ Streamlit UI
st.title("🏫 학교 건강 진단 챗봇")
st.markdown("학생의 증상과 체온을 입력하면, 가능한 질병과 행동을 안내해줍니다.")

temp = st.slider("🌡️ 체온을 선택하세요", 35.0, 41.0, 36.8, 0.1)
symptoms = st.text_input("🤒 증상을 입력하세요 (쉼표로 구분)", "")

if st.button("진단하기"):
    result = diagnose(temp, symptoms)
    st.subheader("🔍 진단 결과")
    st.write(f"**• 질병:** {result['질병']}")
    st.write(f"**• 추천 약품:** {', '.join(result['약품']) if result['약품'] else '없음'}")
    st.write(f"**• 추천 행동:** {result['행동']}")
